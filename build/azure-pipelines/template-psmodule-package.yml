# PowerShell Module Package Pipeline Template
# https://aka.ms/yaml

parameters:
- name: moduleName
  type: string
  default:
- name: moduleVersion
  type: string
  default:
- name: pipelineId
  type: string
  default: ''
- name: artifactNameSource
  type: string
  default: 'PowerShell Module'
- name: artifactNamePackage
  type: string
  default: 'PowerShell Module Package'

steps:
- download: current
  artifact: '${{ parameters.artifactNameSource }}'

#- task: DownloadBuildArtifacts@0
#  inputs:
#    buildType: 'current'
#    downloadType: 'single'
#    artifactName: '${{ parameters.artifactNameSource }}'
#    downloadPath: '$(System.ArtifactsDirectory)'

- task: ArchiveFiles@2
  displayName: 'Package PowerShell Module'
  inputs:
    rootFolderOrFile: '$(Pipeline.Workspace)/${{ parameters.artifactNameSource }}/${{ parameters.moduleName }}'
    includeRootFolder: true
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)/${{ parameters.artifactNamePackage }}/${{ parameters.moduleName }}_${{ parameters.moduleVersion }}.zip'
    replaceExistingArchive: true

- task: PublishBuildArtifacts@1
  displayName: 'Publish PowerShell Module Package Artifact'
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)/${{ parameters.artifactNamePackage }}/${{ parameters.moduleName }}_${{ parameters.moduleVersion }}.zip'
    ArtifactName: '${{ parameters.artifactNamePackage }}'
    publishLocation: 'Container'
